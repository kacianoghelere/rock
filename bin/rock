#!/usr/bin/env node

var P = require('autoresolve')
  , util = require('util')
  , rock = require(P('lib/rock.js'))
  , osenv = require('osenv')
  , fs = require('fs-extra')
  , path = require('path')
  , nom = require('nomnom')


/*program.version(require('../package.json').version)
  .option('-r, --rock [rock]', 'The rock path or Github repo.')
  .parse(process.argv)*/

var opts = nom.script('rock')
  .option('version',  {help: 'Print version and exit.', flag: true, callback: function() { return require('../package.json').version }})
  .option('path',     {help: 'Output path of generated directory structure.', position: 0, required: true})
  .option('rock',     {help: 'The rock path or Github repo.', abbr: 'r', metavar: 'ROCK', required: true})
  .option('config',   {help: 'The config file. Defaults to ~/.rock/rock.conf.json', abbr: 'c', default: path.join(osenv.home(), '.rock', 'rock.conf.json')})
  .parse()


var config = {}
if (fs.existsSync(opts.config)) {
  config = fs.readJSONFileSync(opts.config)
}

if (opts.rock) {
  rock.fetchRepo(opts.path, opts.rock, config, function(err){
    if (err) cl.exit(1, err)
  })
}




